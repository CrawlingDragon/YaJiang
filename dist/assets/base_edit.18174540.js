var q=Object.defineProperty,P=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var v=(t,e,s)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,k=(t,e)=>{for(var s in e||(e={}))U.call(e,s)&&v(t,s,e[s]);if(C)for(var s of C(e))z.call(e,s)&&v(t,s,e[s]);return t},w=(t,e)=>P(t,M(e));import{H as A}from"./header.1705d6a2.js";import{m as B,c as u,e as h,h as _,j as a,g as m,k as r,f as E,F as G,i as L,v as F,x as j,y as H,z as N}from"./index.a3582b47.js";import{C as R}from"./compressor.esm.c4e5fc50.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";import"./fast_nav.a53c4cb6.js";const T={metaInfo:{title:"\u53D1\u5E03\u519C\u4E8B"},name:"base_edit",components:{Header:A},props:{},data(){return{eitdObj:"",caseValue:"",caseId:"",caseColumns:[],showPicker:!1,date:"",minDate:new Date(2010,1,1),maxDate:new Date(2030,1,1),show:!1,message:"",uploader:[],imgList:[],medicine:[],drugValue:"",medicineColumns:[],drugSizeValue:"",drugNumber:0,haveMedicine:!1,drugPicker:!1,guigeShow:!1,chooseDrugActiveIndex:0,chooseDrugSizeActive:0,pId:0}},computed:w(k({},B(["mid","uId"])),{classId(){return this.$route.query.classId},id(){return this.$route.query.id},afterDrugSizeColumns(){let t=[];return this.medicineColumns.forEach(e=>{this.medicine[this.chooseDrugSizeActive].productid==e.productid&&(t=e.spec_list)}),t},druginfo_product_ids(){let t=[];return this.medicine.forEach(e=>{t.push(e.productid)}),t},druginfo_spec_ids(){let t=[];return this.medicine.forEach(e=>{t.push(e.specid)}),t},druginfo_product_quantity(){let t=[];return this.medicine.forEach(e=>{t.push(e.quantity)}),t},editCase(){return this.$route.query.editCase}}),watch:{},mounted(){this.getCase(),this.getDrugChooseCase(),this.id&&this.getEditData(),this.classId&&this.getOneCaseData()},unmounted(){},methods:{clickCase(){this.editCase!=="no"&&(this.showPicker=!0)},beforeRead(t){return new Promise(e=>{new R(t,{quality:.6,success(s){e(s)},error(s){this.$toast(s.message)}})})},afterRead(t,e){let s=new FormData;s.append("urls[]",t.file,t.file.name),this.$axios.fetchPost("/Mobile/Wen/OssUploadFile",s).then(l=>{if(l.data.code==0)this.imgList.push(l.data.data);else{this.$toast(l.data.message);let i=e.index;this.uploader.splice(i,1)}})},deleteItem(t,e){let s=e.index;return this.imgList.splice(s,1),!0},getEditData(){this.$axios.fetchGet("/Mobile/Gbase/getfarmerdata",{Id:this.id}).then(t=>{if(t.data.code==0){let e=t.data.data;this.caseValue=e.point_name,this.date=`${e.starttime}/${e.endtime}`,this.message=e.content,this.medicine=e.druginfo,e.thumb_urls.forEach(s=>{this.uploader.push({url:s}),this.imgList.push(s)})}})},getOneCaseData(){this.$axios.fetchGet("/Mobile/gbase/getProjectPointData",{classId:this.classId,uId:this.uId}).then(t=>{if(t.data.code==0){let e=t.data.data;this.caseValue=e.point_name,this.caseId=e.point_name_ids,this.date=`${e.starttime}/${e.endtime}`,this.message=e.content,this.medicine=e.druginfo,this.pId=e.point_name_ids.split("_")[0],e.thumb_urls&&e.thumb_urls.forEach(s=>{this.uploader.push({url:s}),this.imgList.push(s)})}})},onCaseConfirm(){let t=this.$refs.casePick.getValues();t[2].pid==""?this.caseId=t[0].id+"_"+t[1].id:this.caseId=t[0].id+"_"+t[2].id,this.pId=t[0].id,this.caseValue=t[0].text+"-"+t[1].text+"-"+t[2].text,this.showPicker=!1},formatDate(t){return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`},onTimeConfirm(t){const[e,s]=t;this.show=!1,this.date=`${this.formatDate(e)}/${this.formatDate(s)}`},onSubmit(t){console.log("submit",t),this.issueFramData()},issueFramData(){let t={},e="",s="";this.id?(t={planer:this.caseId,Id:this.id,starttoendtime:this.date,content:this.message,picurl:this.imgList.join(","),druginfo_product_ids:this.druginfo_product_ids,druginfo_spec_ids:this.druginfo_spec_ids,druginfo_product_quantity:this.druginfo_product_quantity},e="\u4FEE\u6539\u6210\u529F",s="/Mobile/Gbase/subfarmerdata"):(t={planer:this.caseId,uId:this.uId,starttoendtime:this.date,content:this.message,picurl:this.imgList.join(","),druginfo_product_ids:this.druginfo_product_ids,druginfo_spec_ids:this.druginfo_spec_ids,druginfo_product_quantity:this.druginfo_product_quantity,rtype:this.classId?"plan":""},e="\u53D1\u5E03\u6210\u529F",s="/Mobile/Gbase/addfarmerdata"),this.$axios.fetchPost(s,t).then(l=>{l.data.code==0?(this.$toast.success(e),setTimeout(()=>{this.id?this.$router.go(-1):this.$router.push({path:"/cropRecord",query:{pId:this.pId}})},500)):this.$toast.fail(l.data.message)})},getCase(){this.$axios.fetchGet("/Mobile/Gbase/getProjectlist",{mId:this.mid,uId:this.uId}).then(t=>{t.data.code==0&&(this.caseColumns=t.data.data)})},getDrugChooseCase(){this.$axios.fetchGet("/Mobile/Gbase/getBaseDruginfo",{uId:this.uId}).then(t=>{let e=t.data;e.code===0&&(this.medicineColumns=e.data)})},clickChooseDrug(t){this.chooseDrugActiveIndex=t,this.drugPicker=!0,this.chooseDrugSizeActive=t},onDrugConfirm(t){this.drugPicker=!1,this.medicine[this.chooseDrugActiveIndex].name=t.name,this.medicine[this.chooseDrugActiveIndex].productid=t.productid;let e=this.medicine[this.chooseDrugActiveIndex].spec;t.spec_list.filter(l=>l.spec==e).length==0&&(this.medicine[this.chooseDrugActiveIndex].spec=t.spec_list[0].spec,this.medicine[this.chooseDrugActiveIndex].specid=t.spec_list[0].id)},clickChooseDrugSize(t){this.chooseDrugSizeActive=t,this.chooseDrugActiveIndex=t,this.guigeShow=!0},onDrugSizeConfirm(t){this.medicine[this.chooseDrugActiveIndex].spec=t.spec,this.medicine[this.chooseDrugActiveIndex].specid=t.id,this.guigeShow=!1},closeMedicine(t){this.$dialog.confirm({title:"\u5220\u9664\u7528\u836F",message:"\u662F\u5426\u8981\u5220\u9664\u7528\u836F"}).then(()=>{this.medicine.splice(t,1)})},addMedicine(){this.medicine.push({name:"",spec:"",specid:"",quantity:"",drugId:"",productid:""})},goBack(){this.$router.go(-1)}}},I=t=>(j("data-v-fbc90512"),t=t(),H(),t),W={class:"base_edit-container"},Y=I(()=>r("span",{class:"back"},"\u8FD4\u56DE",-1)),J={class:"edit-container"},K={class:"use-medicine"},Q=I(()=>r("div",{class:"title"},"\u7528\u836F",-1)),X={class:"medicine-li"},Z={class:"submit-wrap"},$=N("\u53D1\u5E03");function ee(t,e,s,l,i,n){const b=u("van-icon"),D=u("Header"),c=u("van-field"),p=u("van-picker"),f=u("van-popup"),V=u("van-calendar"),x=u("van-uploader"),y=u("van-button"),S=u("van-form");return h(),_("div",W,[a(D,{indexHeader:!1},{default:m(()=>[r("div",{class:"icon",onClick:e[0]||(e[0]=(...o)=>n.goBack&&n.goBack(...o))},[a(b,{name:"arrow-left",class:"back-icon"}),Y])]),_:1}),r("div",J,[a(S,{onSubmit:n.onSubmit},{default:m(()=>[a(c,{class:"case",readonly:"",clickable:"",autosize:"",name:"case",type:"textarea",rows:"1",modelValue:i.caseValue,"onUpdate:modelValue":e[1]||(e[1]=o=>i.caseValue=o),label:"\u65B9\u6848",placeholder:"\u8BF7\u9009\u62E9",onClick:n.clickCase,rules:[{required:!0,message:"\u65B9\u6848\u4E0D\u80FD\u4E3A\u7A7A"}]},null,8,["modelValue","onClick"]),a(f,{show:i.showPicker,"onUpdate:show":e[3]||(e[3]=o=>i.showPicker=o),position:"bottom"},{default:m(()=>[(h(),E(p,{ref:"casePick","show-toolbar":"",columns:i.caseColumns,onConfirm:n.onCaseConfirm,onCancel:e[2]||(e[2]=o=>i.showPicker=!1),key:i.caseValue},null,8,["columns","onConfirm"]))]),_:1},8,["show"]),r("div",null,[a(c,{readonly:"",clickable:"",name:"datetime",modelValue:i.date,"onUpdate:modelValue":e[4]||(e[4]=o=>i.date=o),label:"\u65F6\u95F4",placeholder:"\u6DFB\u52A0\u65F6\u95F4",onClick:e[5]||(e[5]=o=>i.show=!0),rules:[{required:!0,message:"\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A"}]},null,8,["modelValue"]),a(V,{title:"\u8BF7\u9009\u62E9\u5F00\u59CB\u548C\u7ED3\u675F\u65E5\u671F",show:i.show,"onUpdate:show":e[6]||(e[6]=o=>i.show=o),type:"range","allow-same-day":!0,onConfirm:n.onTimeConfirm,color:"#155BBB","min-date":i.minDate,"max-date":i.maxDate},null,8,["show","onConfirm","min-date","max-date"]),a(c,{modelValue:i.message,"onUpdate:modelValue":e[7]||(e[7]=o=>i.message=o),rows:"2",autosize:"",label:"\u8BB0\u5F55",type:"textarea",maxlength:"500",placeholder:"\u6587\u5B57\u6DFB\u52A0\u8BB0\u5F55\u5185\u5BB9","show-word-limit":"",rules:[{required:!0,message:"\u8BB0\u5F55\u4E0D\u80FD\u4E3A\u7A7A"}]},null,8,["modelValue"]),a(c,{name:"uploader",label:"\u7167\u7247"},{input:m(()=>[a(x,{modelValue:i.uploader,"onUpdate:modelValue":e[8]||(e[8]=o=>i.uploader=o),"after-read":n.afterRead,"before-delete":n.deleteItem,accept:"image/*","max-count":6,"before-read":n.beforeRead},null,8,["modelValue","after-read","before-delete","before-read"])]),_:1})]),r("div",K,[Q,(h(!0),_(G,null,L(i.medicine,(o,g)=>(h(),_("div",{class:"add-box van-hairline--bottom",key:o.specid},[a(b,{name:"cross",class:"cross",onClick:d=>n.closeMedicine(g)},null,8,["onClick"]),r("div",X,[a(c,{readonly:"",clickable:"",name:"picker",modelValue:o.name,"onUpdate:modelValue":d=>o.name=d,label:"\u540D\u79F0",placeholder:"\u8BF7\u9009\u62E9\u836F\u54C1",onClick:d=>n.clickChooseDrug(g),rules:[{required:!0,message:"\u836F\u54C1\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}]},null,8,["modelValue","onUpdate:modelValue","onClick"]),a(f,{show:i.drugPicker,"onUpdate:show":e[10]||(e[10]=d=>i.drugPicker=d),position:"bottom"},{default:m(()=>[F(" \u9009\u62E9\u836F\u54C1 "),a(p,{"show-toolbar":"",columns:i.medicineColumns,onConfirm:n.onDrugConfirm,onCancel:e[9]||(e[9]=d=>i.drugPicker=!1)},null,8,["columns","onConfirm"])]),_:1},8,["show"])]),r("div",null,[a(c,{readonly:"",clickable:"",name:"picker",modelValue:o.spec,"onUpdate:modelValue":d=>o.spec=d,label:"\u89C4\u683C",placeholder:"\u8BF7\u9009\u62E9\u89C4\u683C",onClick:d=>n.clickChooseDrugSize(g),rules:[{required:!0,message:"\u89C4\u683C\u4E0D\u80FD\u4E3A\u7A7A"}]},null,8,["modelValue","onUpdate:modelValue","onClick"]),a(f,{show:i.guigeShow,"onUpdate:show":e[12]||(e[12]=d=>i.guigeShow=d),position:"bottom"},{default:m(()=>[a(p,{"show-toolbar":"",columns:n.afterDrugSizeColumns,onConfirm:n.onDrugSizeConfirm,onCancel:e[11]||(e[11]=d=>i.guigeShow=!1)},null,8,["columns","onConfirm"])]),_:1},8,["show"])]),a(c,{modelValue:o.quantity,"onUpdate:modelValue":d=>o.quantity=d,name:"\u7528\u91CF/\u7528\u6CD5",label:"\u7528\u91CF/\u7528\u6CD5",placeholder:"\u8BF7\u8F93\u5165\u7528\u91CF/\u7528\u6CD5",class:"number",rules:[{required:!0,message:"\u7528\u91CF/\u7528\u6CD5\u4E0D\u80FD\u4E3A\u7A7A"}]},null,8,["modelValue","onUpdate:modelValue"])]))),128)),r("div",{class:"add-btn-title",onClick:e[13]||(e[13]=(...o)=>n.addMedicine&&n.addMedicine(...o))},"\u589E\u52A0")]),r("div",Z,[a(y,{round:"",block:"",type:"info","native-type":"submit",class:"submit",color:"#155BBB"},{default:m(()=>[$]),_:1})])]),_:1},8,["onSubmit"])])])}var de=O(T,[["render",ee],["__scopeId","data-v-fbc90512"]]);export{de as default};
