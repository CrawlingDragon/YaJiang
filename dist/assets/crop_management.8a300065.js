var F=Object.defineProperty,L=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var P=(e,t,s)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,y=(e,t)=>{for(var s in t||(t={}))N.call(t,s)&&P(e,s,t[s]);if(C)for(var s of C(t))M.call(t,s)&&P(e,s,t[s]);return e},T=(e,t)=>L(e,H(t));import{c as l,e as a,h as n,k as o,t as I,j as r,W as V,z as b,m as B,a3 as D,g as u,v as W,F as f,i as g,B as j,x as z,y as A,l as q}from"./index.3518e5b0.js";import{_ as $}from"./plugin-vue_export-helper.21dcd24c.js";const R={name:"progress_item",components:{},props:{item:{type:Object,default:function(){return{classname:"",percent:0,id:""}}}},data(){return{}},computed:{},watch:{},mounted(){},unmounted(){},methods:{}},G={class:"progress-item"},O={class:"left"},U={class:"mid"},J={class:"right"};function K(e,t,s,h,_,i){const p=l("van-progress");return a(),n("div",G,[o("div",O,I(s.item.classname),1),o("div",U,[r(p,{percentage:s.item.percent,color:"#155BBB","show-pivot":!1,"stroke-width":"8"},null,8,["percentage"])]),o("div",J,[V(e.$slots,"default",{},void 0,!0),b(I(s.item.percent)+"%",1)])])}var S=$(R,[["render",K],["__scopeId","data-v-c24f449c"]]);const Q={name:"period",components:{ProgressItem:S},props:{period:{type:Object,default:function(){return{}}}},data(){return{show:!1,activeItem:""}},computed:y({},B(["uId"])),watch:{},mounted(){},unmounted(){},methods:{confirmDialog(){this.confirmIssue(this.activeItem.id,this.uId)},cancelDialog(){this.$router.push({path:"/base_edit",query:{classId:this.activeItem.id,editCase:"no"}})},issue(e){let t=e.iswrite;this.activeItem=e,t==0?this.show=!0:this.$router.push({path:"/base_edit",query:{classId:e.id,editCase:"no"}})},detail(e){this.$router.push({path:"/base_fram_detail",query:{id:e.rid}})},confirmIssue(e,t){D.fetchPost("/Mobile/Gbase/subFarmerDatacommit",{classid:e,uId:t}).then(s=>{let h=s.data;h.code===0&&window.location.reload(),this.$toast(h.message)})}}},x=e=>(z("data-v-60e7dc78"),e=e(),A(),e),X={class:"period-content van-hairline--bottom"},Y={class:"progress"},Z={class:"left"},ee={class:"mid"},te={key:0,class:"finished"},se=x(()=>o("span",null,"\u5DF2\u5B8C\u6210",-1)),oe={key:1,class:"finish"},ae=x(()=>o("span",null,"\u5F85\u5B8C\u6210",-1)),ne={class:"right"},ie=["onClick"],re=["onClick"],ce=x(()=>o("div",{class:"van-dialog__message"},"\u8BE5\u519C\u4E8B\u7BA1\u7406\u5185\u5BB9\u4E3A\u9009\u586B\uFF0C\u53EF\u70B9\u51FB\u786E\u8BA4\u76F4\u63A5\u5B8C\u6210",-1));function de(e,t,s,h,_,i){const p=l("ProgressItem"),m=l("van-icon"),k=l("van-dialog");return a(),n("div",X,[o("div",Y,[r(p,{item:{classname:s.period.classname,percent:s.period.percent}},{default:u(()=>[W(' <span class="p1">{{ period.classname }}</span> ')]),_:1},8,["item"])]),(a(!0),n(f,null,g(s.period.lists,c=>(a(),n("div",{class:"item",key:c.id},[o("div",Z,I(c.classname),1),o("div",ee,[c.isdeal===1?(a(),n("div",te,[r(m,{name:"clock-o",class:"clock"}),se])):(a(),n("div",oe,[r(m,{name:"passed",class:"passsed"}),ae]))]),o("div",ne,[c.isdeal===1?(a(),n("div",{key:0,class:"btn btn2",onClick:w=>i.detail(c)},"\u8BE6\u60C5",8,ie)):(a(),n("div",{key:1,class:"btn btn1",onClick:w=>i.issue(c)},"\u53D1\u5E03",8,re))])]))),128)),r(k,{show:_.show,"onUpdate:show":t[2]||(t[2]=c=>_.show=c),message:"\u8BE5\u519C\u4E8B\u7BA1\u7406\u5185\u5BB9\u4E3A\u9009\u586B\uFF0C\u53EF\u70B9\u51FB\u786E\u8BA4\u76F4\u63A5\u5B8C\u6210","show-confirm-button":"","show-cancel-button":"","confirm-button-text":"\u76F4\u63A5\u5B8C\u6210","cancel-button-text":"\u53BB\u53D1\u5E03",onConfirm:i.confirmDialog,onCancel:i.cancelDialog},{default:u(()=>[ce,o("div",{class:"close",onClick:[t[0]||(t[0]=j(()=>{},["stop"])),t[1]||(t[1]=c=>_.show=!1)]},[r(m,{name:"close",size:"25"})])]),_:1},8,["show","onConfirm","onCancel"])])}var le=$(Q,[["render",de],["__scopeId","data-v-60e7dc78"]]);const _e={name:"crop_management",components:{Period:le,ProgressItem:S},props:{},data(){return{w:10,refItem:[],periods:[],management:[],active1:0,active:0,isFixed:!1,topArr:[]}},computed:T(y({},B(["uId"])),{pId(){return this.$route.query.pId},navProgressList(){let e=[];return this.management.forEach((t,s)=>{t.classname&&e.push({classname:t.classname,percent:t.percent,option:this.topArr[s],id:t.id})}),e}}),watch:{management(){this.$nextTick(()=>{this.periods.forEach(e=>{this.topArr.push(e.offsetTop-100)})})}},mounted(){this.getmanagementData(),window.addEventListener("scroll",this.scrollHander,!1)},unmounted(){window.removeEventListener("scroll",this.scrollHander,!1)},methods:{setPeriods(e){this.periods.push(e)},setItemRef(e){this.refItem.push(e)},clickProgress(e){this.clickHandle(1,e)},stickyChange(e){this.isFixed=e.isFixed},clickHandle(e,t){this.$nextTick(()=>{this.top=this.periods[t].offsetTop,window.scrollTo({top:this.top-70,behavior:"smooth"}),setTimeout(()=>{this.active1=t},201)})},scrollHander(){const e=document.documentElement.scrollTop;setTimeout(()=>{const t=[...this.navProgressList].reverse();for(var s=0;s<t.length;s++)if(t[s].option<=e){this.active1=this.active=t.length-s-1;break}this.active1=this.active},200)},getmanagementData(){D.fetchPost("/Mobile/Gbase/getBaseTasklists",{pId:this.pId,uId:this.uId}).then(e=>{let t=e.data;t.code==0?(this.management=t.data,this.getNavWidth()):alert(t.message)})},getNavWidth(){this.$nextTick(()=>{this.refItem.forEach(e=>{let t=e.offsetWidth;this.w+=t}),this.$refs.title.style.width=this.w+"px"})}}},he={class:"crop_management-container"},pe={class:"nav-bar van-hairline--bottom",ref:"h1"},me=b(" \u519C\u4E8B\u7BA1\u7406 "),ue=b("\u519C\u4E8B\u8BB0\u5F55"),ve={class:"progress-box van-hairline--bottom",ref:"h2"},fe=["onClick"],ge={class:"period-box"},Ie={class:"period-title-bar"},ke={class:"title-content",ref:"title"},we=["onClick"],ye={class:"item"};function be(e,t,s,h,_,i){const p=l("router-link"),m=l("ProgressItem"),k=l("van-icon"),c=l("van-sticky"),w=l("Period");return a(),n("div",he,[o("div",pe,[r(p,{class:"nav",to:{path:"/cropManagement",query:{pId:this.$route.query.pId,gId:this.$route.query.gId}},replace:""},{default:u(()=>[me]),_:1},8,["to"]),r(p,{class:"nav",to:{path:"/cropRecord",query:{pId:this.$route.query.pId,gId:this.$route.query.gId}},replace:""},{default:u(()=>[ue]),_:1},8,["to"])],512),o("div",ve,[(a(!0),n(f,null,g(i.navProgressList,(d,v)=>(a(),n("div",{key:d.classname,onClick:E=>i.clickProgress(v)},[r(m,{item:d},null,8,["item"])],8,fe))),128))],512),o("div",ge,[r(c,{"offset-top":40,onScroll:i.stickyChange},{default:u(()=>[o("div",Ie,[o("div",ke,[(a(!0),n(f,null,g(i.navProgressList,(d,v)=>(a(),n("div",{key:d.classname,ref_for:!0,ref:i.setItemRef,class:q(["item-wrap",{active:v==_.active1}]),onClick:E=>i.clickHandle(d,v)},[o("div",ye,I(d.classname),1),r(k,{name:"arrow",class:"arrow"})],10,we))),128))],512)])]),_:1},8,["onScroll"]),o("div",{class:q({paddingTop:_.isFixed})},[(a(!0),n(f,null,g(_.management,d=>(a(),n("div",{ref_for:!0,ref:i.setPeriods,key:d.clasname,class:"periods"},[o("div",{ref_for:!0,ref:d.id},[r(w,{period:d},null,8,["period"])],512)]))),128))],2)])])}var Pe=$(_e,[["render",be],["__scopeId","data-v-56a44d42"]]);export{Pe as default};
