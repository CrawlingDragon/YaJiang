var G=Object.defineProperty,q=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var M=(s,e,o)=>e in s?G(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o,I=(s,e)=>{for(var o in e||(e={}))S.call(e,o)&&M(s,o,e[o]);if(k)for(var o of k(e))U.call(e,o)&&M(s,o,e[o]);return s},T=(s,e)=>q(s,F(e));import{H as N}from"./header.1705d6a2.js";import{m as O,I as z,c as r,e as m,h as f,j as n,k as i,g,C as u,D as h,F as y,i as D,t as d,x as E,y as R,f as V,l as P,z as Y,v}from"./index.a3582b47.js";import{C as A}from"./compressor.esm.c4e5fc50.js";import{_ as J}from"./plugin-vue_export-helper.21dcd24c.js";import"./fast_nav.a53c4cb6.js";const K={name:"base_edit",components:{Header:N},props:{},data(){return{eitdObj:"",caseValue:"",caseId:"",caseColumns:[],showPicker:!1,date:"",minDate:new Date(2010,1,1),maxDate:new Date(2030,1,1),show:!1,message:"",uploader:[],imgList:[],medicine:[1,2],haveMedicine:!1,detailObj:"",resultinfo:"",ifHaveMoreText:!1,showTextMore:!0,druginfo:[]}},computed:T(I({},O(["mid","uId"])),{id(){return this.$route.query.id}}),watch:{message(s){s!=""&&setTimeout(()=>{this.$refs.message.offsetHeight>=73&&(this.ifHaveMoreText=!0)},100)}},mounted(){this.getCase(),this.$route.query.id&&this.getEditData()},unmounted(){},methods:{imagePriview(s,e){z({images:s,startPosition:e,closeable:!0})},afterRead(s,e){let o=this;new A(s.file,{quality:.4,success(c){let t=new FormData;t.append("urls[]",c,c.name),o.$axios.fetchPost("Mobile/Gbase/OssUploadFile",t).then(l=>{if(l.data.code==0)o.imgList.push(l.data.data);else{o.$toast(l.data.message);let _=e.index;o.uploader.splice(_,1)}})}})},deleteItem(s,e){let o=e.index;return this.imgList.splice(o,1),!0},getEditData(){this.$axios.fetchGet("Mobile/Gbase/getfarmerdata",{Id:this.id}).then(s=>{if(s.data.code==0){let e=s.data.data;this.detailObj=e,this.druginfo=e.druginfo,this.caseValue=e.point_name,this.resultinfo=e.resultinfo,this.date=`${e.starttime}/${e.endtime}`,this.message=e.content,this.imgList=e.thumb_urls}})},onCaseConfirm(s){let e=this.$refs.casePick.getValues();e[2].pid==""?this.caseId=e[0].id+"_"+e[1].id:this.caseId=e[0].id+"_"+e[2].id,this.caseValue=s.join("-"),this.showPicker=!1},formatDate(s){return`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}`},onTimeConfirm(s){const[e,o]=s;this.show=!1,this.date=`${this.formatDate(e)}/${this.formatDate(o)}`},issueFramData(){let s={},e="",o="";this.$route.query.id?(s={planer:this.caseId,Id:this.$route.query.id,starttoendtime:this.date,content:this.message,picurl:this.imgList.join(",")},e="\u4FEE\u6539\u6210\u529F",o="/Mobile/Gbase/subfarmerdata"):(s={planer:this.caseId,uId:this.uId,starttoendtime:this.date,content:this.message,picurl:this.imgList.join(",")},e="\u53D1\u5E03\u6210\u529F",o="/Mobile/Gbase/addfarmerdata"),this.$axios.fetchPost(o,s).then(c=>{c.data.code==0?(this.$toast.success(e),setTimeout(()=>{this.$router.go(-1)},500)):this.$toast.fail(c.data.message)})},getCase(){this.$axios.fetchGet("Mobile/Gbase/getProjectlist",{mId:this.mid,pId:16}).then(s=>{s.data.code==0&&(this.caseColumns=s.data.data)})},closeMedicine(s){console.log("index :>> ",s)},addMedicine(){this.medicine.push(1)},goBack(){this.$router.go(-1)},goToBug(s){window.open(s,"_blank")}}},w=s=>(E("data-v-0ec18545"),s=s(),R(),s),Q={class:"base_edit-container"},W={class:"edit-container"},X=w(()=>i("div",{class:"label"},"\u8BB0\u5F55",-1)),Z={class:"box"},$=w(()=>i("div",{class:"title"},"\u7528\u836F\u4FE1\u606F",-1)),ee={class:"me-ul"},se={class:"mid"},te={class:"p1"},oe={class:"p2"},ie={class:"p2"},ae=["onClick"],ne={class:"box remark"},le=w(()=>i("div",{class:"title"},"\u8BC4\u8BBA",-1)),re={class:"remark-ul"},de={class:"item"},ce={class:"name"},me={class:"text"},ue={class:"time"};function he(s,e,o,c,t,l){const _=r("Header"),p=r("van-field"),H=r("van-picker"),B=r("van-popup"),L=r("van-calendar"),x=r("van-icon"),b=r("van-image"),j=r("van-form");return m(),f("div",Q,[n(_,{indexHeader:!1}),i("div",W,[n(j,null,{default:g(()=>[n(p,{class:"case",readonly:"",name:"case",modelValue:t.caseValue,"onUpdate:modelValue":e[0]||(e[0]=a=>t.caseValue=a),label:"\u65B9\u6848",placeholder:"\u65E0"},null,8,["modelValue"]),n(B,{show:t.showPicker,"onUpdate:show":e[2]||(e[2]=a=>t.showPicker=a),position:"bottom"},{default:g(()=>[(m(),V(H,{ref:"casePick","show-toolbar":"",columns:t.caseColumns,onConfirm:l.onCaseConfirm,onCancel:e[1]||(e[1]=a=>t.showPicker=!1),key:t.caseValue},null,8,["columns","onConfirm"]))]),_:1},8,["show"]),i("div",null,[n(p,{readonly:"",clickable:"",name:"datetime",modelValue:t.date,"onUpdate:modelValue":e[3]||(e[3]=a=>t.date=a),label:"\u65F6\u95F4",placeholder:"\u65E0"},null,8,["modelValue"]),n(L,{show:t.show,"onUpdate:show":e[4]||(e[4]=a=>t.show=a),type:"range",onConfirm:l.onTimeConfirm,color:"#155BBB","min-date":t.minDate,"max-date":t.maxDate},null,8,["show","onConfirm","min-date","max-date"]),i("div",{class:P(["record",{"record-more":t.ifHaveMoreText}])},[X,i("div",{class:P(["text",{more:t.showTextMore&&t.ifHaveMoreText}]),ref:"message"},d(t.message),3),u(i("div",{class:"open-more",onClick:e[5]||(e[5]=a=>t.showTextMore=!t.showTextMore)},[Y(d(t.showTextMore?"\u5C55\u5F00\u66F4\u591A":"\u6536\u7F29")+" ",1),u(n(x,{name:"arrow-down"},null,512),[[h,t.showTextMore]]),u(n(x,{name:"arrow-up"},null,512),[[h,!t.showTextMore]])],512),[[h,t.ifHaveMoreText]])],2),v(` <van-field
            v-model="message"
            rows="2"
            autosize
            label="\u8BB0\u5F55"
            type="textarea"
            maxlength="500"
            readonly
            placeholder="\u65E0"
            class="message"
          /> `),u(n(p,{label:"\u7167\u7247"},{input:g(()=>[(m(!0),f(y,null,D(t.imgList,(a,C)=>(m(),V(b,{class:"upload-img",key:a,src:a,fit:"cover",onClick:fe=>l.imagePriview(t.imgList,C)},null,8,["src","onClick"]))),128))]),_:1},512),[[h,t.imgList.length>=1]])]),v("v-if",!0)]),_:1}),u(i("div",Z,[$,i("ul",ee,[(m(!0),f(y,null,D(t.druginfo,a=>(m(),f("li",{key:a.name},[n(b,{class:"img",src:a.pic,fit:"cover"},null,8,["src"]),i("div",se,[i("p",te,d(a.name),1),i("p",oe,"\u89C4\u683C\uFF1A"+d(a.spec),1),i("div",ie,"\u7528\u6CD5\u7528\u91CF\u8BF4\u660E:"+d(a.quantity),1)]),v(' <div class="right"></div> '),i("div",{class:"bug-btn",onClick:C=>l.goToBug(a.url)},"\u8D2D\u4E70",8,ae)]))),128))])],512),[[h,t.druginfo.length]]),u(i("div",ne,[le,i("div",re,[i("div",de,[i("div",ce,d(t.resultinfo.expertname),1),i("div",me,d(t.resultinfo.result),1),i("div",ue,d(t.resultinfo.addtime),1)])])],512),[[h,t.resultinfo!=""]])])])}var be=J(K,[["render",he],["__scopeId","data-v-0ec18545"]]);export{be as default};
