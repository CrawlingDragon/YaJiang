{"version":3,"sources":["webpack:///./src/views/ask/ask.vue?677f","webpack:///./src/views/ask/ask.vue","webpack:///./src/components/local/local.vue","webpack:///./src/components/local/local.vue?c8ba","webpack:///./src/views/ask/ask.vue?4540","webpack:///./src/components/local/local.vue?10fe","webpack:///./src/common/js/baidu_locationAddress.js"],"names":["class","indexHeader","from","navHeader","onSubmit","message","rows","autosize","type","placeholder","show-word-limit","maxlength","name","input","uploader","after-read","afterRead","before-delete","deleteItem","accept","max-count","goToChooseCrop","crop","readonly","input-align","border","expert","propMid","mid","initMid","ref","address","round","block","native-type","Component","getCrop","id","text","label","reLocation","right-icon","setup","props","emit","store","axiosAddress","state","userInfoLocation","locationTime","addressObj","askGeolocationAgain","localtionAddress","value","alert","title","confirmButtonText","confirmButtonColor","then","String","default","data","computed","__exports__","meta","components","Header","Foot","HospitalHeader","Loacl","fid","imgList","imgListTiny","ismember","isShaoxing","userInfo","submitBoolean","this","$route","query","expertId","created","watch","mounted","hospitalName","methods","values","length","$toast","subAsk","$router","push","path","file","detail","that","quality","success","result","formData","FormData","append","$axios","fetchPost","res","code","data_tiny","index","splice","val","obj","mId","uId","content","fId","picurl","join","picurl_tiny","location","setTimeout","go","render","geolocation","Promise","resolve","useStore","axiosAddressComputed","undefined","BMapGL","Geolocation","getCurrentPosition","r","console","log","getStatus","province","city","district","commit","geo","geolocationAgain","askGeo"],"mappings":"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","file":"js/ask.af6b79cf.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./ask.vue?vue&type=style&index=0&id=c08b0a06&lang=stylus&scoped=true\"","<template>\n  <div class=\"ask-container\">\n    <Header :indexHeader=\"false\"></Header>\n    <HospitalHeader v-if=\"from == 'hospital'\" navHeader=\"提问\"></HospitalHeader>\n    <div class=\"title\">问题描述</div>\n    <van-form @submit=\"onSubmit\" class=\"from\">\n      <van-field\n        v-model=\"message\"\n        rows=\"4\"\n        autosize\n        type=\"textarea\"\n        placeholder=\"请输入具体问题描述\"\n        class=\"text\"\n        show-word-limit\n        maxlength=\"300\"\n        name=\"message\"\n      />\n      <van-field name=\"uploader\" class=\"uploader\">\n        <template #input>\n          <van-uploader\n            v-model=\"uploader\"\n            :after-read=\"afterRead\"\n            :before-delete=\"deleteItem\"\n            accept=\"image/*\"\n            :max-count=\"9\"\n          />\n        </template>\n      </van-field>\n      <div class=\"choose-crop\" @click=\"goToChooseCrop\">\n        <div class=\"left\">作物</div>\n        <van-field\n          v-model=\"crop\"\n          readonly\n          class=\"right\"\n          :class=\"{ location: crop != '请选择' }\"\n          input-align=\"right\"\n          :border=\"false\"\n          name=\"crop\"\n        />\n        <van-icon name=\"arrow\" class=\"arrow\" />\n      </div>\n      <div class=\"list\" v-if=\"expert\">\n        <div class=\"left\">咨询专家</div>\n        <div class=\"right\">{{ expert }}</div>\n      </div>\n      <Loacl\n        :propMid=\"from ? mid : initMid\"\n        ref=\"localRef\"\n        v-model:address=\"address\"\n      ></Loacl>\n      <div class=\"sub\">\n        <van-button round block type=\"info\" native-type=\"submit\" class=\"btn\">\n          提交\n        </van-button>\n      </div>\n    </van-form>\n    <router-view v-slot=\"{ Component }\">\n      <keep-alive>\n        <component :is=\"Component\" @getCrop=\"getCrop\" />\n      </keep-alive>\n    </router-view>\n    <Foot></Foot>\n  </div>\n</template>\n\n<script>\nimport Header from \"@/components/header/header\";\nimport HospitalHeader from \"@/components/hospital_header/hospital_header\";\nimport Foot from \"@/components/foot/foot\";\nimport Loacl from \"@/components/local/local.vue\";\nimport { useMeta } from \"vue-meta\";\nimport { mapState } from \"vuex\";\nimport Compressor from \"compressorjs\";\nexport default {\n  setup() {\n    const { meta } = useMeta({ title: \"提问\" });\n    return { meta };\n  },\n  name: \"ask\",\n  components: { Header, Foot, HospitalHeader, Loacl },\n  props: {},\n  data() {\n    return {\n      address: \"定位中···\",\n      message: \"\",\n      crop: \"请选择\",\n      fid: \"\",\n      uploader: [],\n      imgList: [],\n      imgListTiny: [],\n      ismember: \"\",\n      isShaoxing: \"\",\n      userInfo: \"\",\n      locationTime: \"first\",\n      submitBoolean: true\n    };\n  },\n  computed: {\n    ...mapState([\"uId\", \"mid\", \"initMid\", \"hospitalName\"]),\n    from() {\n      return this.$route.query.from;\n    },\n    expert() {\n      return this.$route.query.expert;\n    },\n    expertId() {\n      return this.$route.query.expertId;\n    },\n    // localRef() {\n    //   return this.$refs.localRef.addressObj;\n    // },\n    ...mapState([\"uId\"])\n  },\n  created() {},\n  watch: {},\n  mounted() {\n    this.meta.title = this.from === \"hospital\" ? this.hospitalName : \"提问\";\n  },\n  methods: {\n    onSubmit(values) {\n      if (values.message == \"\") {\n        this.$toast(\"问题描述不能为空\");\n        return;\n      } else if (values.message.length <= 9) {\n        this.$toast(\"问题描述不能少余10个字\");\n        return;\n      } else if (this.address == \"定位中···\") {\n        this.$toast(\"地址定位中,请稍等\");\n        return;\n      }\n      this.subAsk();\n    },\n    goToChooseCrop() {\n      //选择作物\n      this.$router.push({\n        path: \"/ask/ask_choose_crop\",\n        query: { crop: this.crop == \"请选择\" ? \"\" : this.crop }\n      });\n    },\n    getCrop(crop) {\n      //选择作物\n      this.crop = crop.name;\n      this.fid = crop.fid;\n    },\n    // beforeRead(file) {\n    //   // 上传图片之前，压缩图片\n    //   return new Promise(resolve => {\n    //     let img = exifImg(file).then(res => {\n    //       return res;\n    //     });\n    //     resolve(img);\n    //   });\n    // },\n    afterRead(file, detail) {\n      // 图片上传\n      let that = this;\n      new Compressor(file.file, {\n        quality: 0.4,\n        success(result) {\n          let formData = new FormData();\n          // console.log(\"result\", result);\n          formData.append(\"urls[]\", result, result.name);\n          that.$axios\n            .fetchPost(\"/Mobile/Wen/OssUploadFile\", formData)\n            .then(res => {\n              // console.log(\"res :>> \", res);\n              if (res.data.code == 0) {\n                that.imgList.push(res.data.data);\n                that.imgListTiny.push(res.data.data_tiny);\n                // this.uploader.push({url:res.data.data,name:'img'})\n              } else {\n                that.$toast(res.data.message);\n                let index = detail.index;\n                that.uploader.splice(index, 1);\n              }\n            });\n        }\n      });\n    },\n    deleteItem(file, val) {\n      let index = val.index;\n      this.imgList.splice(index, 1);\n      this.imgListTiny.splice(index, 1);\n      return true;\n    },\n    subAsk() {\n      let obj = {\n        mId: this.from ? this.mid : this.initMid, //mId\n        uId: this.uId, //用户ID\n        content: this.message, //发布内容\n        fId: this.fid, //作物ID\n        expertId: this.expertId,\n        picurl: this.imgList.join(\",\"),\n        picurl_tiny: this.imgListTiny.join(\",\"),\n        location: this.address === \"抱歉未定位到\" ? \"定位失败\" : this.address\n      };\n      if (this.submitBoolean) {\n        this.submitBoolean = false;\n        this.$axios.fetchPost(\"Mobile/Wen/addWenQuestion\", obj).then(res => {\n          this.$toast(res.data.message);\n          if (res.data.code == 0) {\n            setTimeout(() => {\n              this.$router.go(-1);\n              this.submitBoolean = true;\n            }, 1000);\n          } else {\n            this.submitBoolean = true;\n          }\n        });\n      }\n    }\n  }\n};\n</script>\n<style lang=\"stylus\" scoped>\n.ask-container\n  height 100%\n  background #fff\n  position relative\n  padding-bottom 0px\n  .title\n    background #fff\n    color #333333\n    font-size 16px\n    line-height 16px\n    padding 15px 12px 10px 12px\n  .from\n    background #fff\n    .text\n      margin-right 12px\n      margin-left 12px\n      width auto\n      height 130px\n      font-size 12px\n      border 1px solid #e5e5e5\n    .uploader\n      padding 10px 12px\n      border-bottom 1px solid #e5e5e5\n      &.van-cell::after\n        display none\n    .choose-crop\n      border-bottom 1px solid #e5e5e5\n      display flex\n      align-items center\n      height 50px\n      padding-left 12px\n      .left\n        width 106px\n        color #333333\n        font-size 16px\n      .right\n        flex 1\n        color #999999\n        text-align right\n        /deep/.van-field__control\n          color #999\n          font-size 16px\n        &.location\n          color #333\n          &.fail\n            color #999\n            /deep/.van-field__control\n              color #999\n          /deep/.van-field__control\n            color #333\n      .arrow\n        font-size 12px\n        color #999999\n        margin 0 12px\n    .list\n      height 50px\n      line-height 50px\n      display flex\n      align-items center\n      justify-content space-between\n      font-size 16px\n      color #333\n      padding 0 35px 0 12px\n      border-bottom 1px solid #e5e5e5\n    .sub\n      background #ebebeb\n      padding 16px\n      padding-bottom 60px\n      .btn\n        margin-right 12px\n        border-radius 4px\n        background $theme-color\n        font-size 15px\n        color #fff\n        width 100%\n        border none\n/deep/.van-field__control\n  font-size 14px\n</style>\n","<template>\n  <div>\n    <van-field\n      v-model=\"text\"\n      class=\"address\"\n      name=\"所在位置\"\n      label=\"所在位置\"\n      placeholder=\"\"\n      readonly\n      input-align=\"right\"\n      :class=\"{\n        fail: text === '定位中···' || text === '抱歉未定位到'\n      }\"\n      @click=\"reLocation\"\n    >\n      <template #right-icon>\n        <van-icon name=\"arrow\" />\n      </template>\n    </van-field>\n    <div id=\"container\"></div>\n  </div>\n</template>\n<script>\n// import AMap from \"AMap\";\n\nimport { askGeo } from \"@/common/js/baidu_locationAddress\";\nimport { mapState } from \"vuex\";\n// import storage from \"good-storage\";\nimport { onMounted, computed, reactive, toRefs, ref } from \"vue\";\nimport { useStore } from \"vuex\";\nimport { Dialog } from \"vant\";\nexport default {\n  name: \"local\",\n  setup(props, { emit }) {\n    const store = useStore();\n    const axiosAddress = computed(() => store.state.axiosAddress);\n    const userInfoLocation = computed(() => store.state.userInfoLocation);\n    // console.log(\"userInfoLocation\", userInfoLocation);\n    const locationTime = ref(\"first\");\n    const addressObj = reactive({\n      // 定位数据\n      text: \"定位中···\"\n    });\n\n    onMounted(() => {\n      reLocation();\n    });\n    async function reLocation() {\n      // if (locationTime.value === \"sucess\") {\n      //   return;\n      // }\n      const { askGeolocationAgain } = askGeo();\n      addressObj.text = \"定位中···\";\n      let localtionAddress = await askGeolocationAgain(); // 定位的地址\n      // addressObj.text = axiosAddress.value;\n      // console.log(\"userInfoLocation\", userInfoLocation.value);\n      if (localtionAddress !== 6 && localtionAddress !== 99) {\n        addressObj.text = localtionAddress;\n        locationTime.value = \"sucess\";\n        emit(\"update:address\", addressObj.text);\n      } else {\n        if (locationTime.value == \"first\") {\n          addressObj.text = \"抱歉未定位到\";\n          locationTime.value = \"noFirst\";\n          emit(\"update:address\", addressObj.text);\n          return;\n        }\n        if (localtionAddress == 6) {\n          //6是没有权限\n          //7是服务不可用\n          //定位权限未打开\n          // 位置结果未知。对应数值“2”\n          if (userInfoLocation.value === \"\") {\n            //个人资料地址为空\n            Dialog.alert({\n              title: \"定位失败\",\n              message: \"检测到您未打开定位服务\",\n              confirmButtonText: \"不显示地址\",\n              confirmButtonColor: \"#155BBB\"\n            }).then(() => {\n              // on close\n              addressObj.text = \"\";\n              emit(\"update:address\", addressObj.text);\n            });\n          } else {\n            //个人资料地址不为空\n            Dialog.alert({\n              title: \"定位失败\",\n              message:\n                \"检测到您未打开定位服务,已自动切换至 \" + userInfoLocation.value,\n              confirmButtonText: \"好的\",\n              confirmButtonColor: \"#155BBB\"\n            }).then(() => {\n              // on close\n              addressObj.text = userInfoLocation.value;\n              emit(\"update:address\", addressObj.text);\n            });\n          }\n        } else {\n          //未打开定位权限\n          if (userInfoLocation.value === \"\") {\n            Dialog.alert({\n              title: \"定位失败\",\n              message:\n                \"抱歉未定位到您的所在地址,后期可以在“我的-编辑资料-所在地”完善信息\",\n              confirmButtonText: \"不显示地址\",\n              confirmButtonColor: \"#155BBB\"\n            }).then(() => {\n              // on close\n              addressObj.text = \"\";\n              emit(\"update:address\", addressObj.text);\n            });\n          } else {\n            Dialog.alert({\n              title: \"定位失败\",\n              message:\n                \"抱歉未定位到您的所在地址,已自动切换至 \" +\n                userInfoLocation.value,\n              confirmButtonText: \"好的\",\n              confirmButtonColor: \"#155BBB\"\n            }).then(() => {\n              // on close\n              addressObj.text = userInfoLocation.value;\n              // that.$emit(\"getAddress\", that.address);\n              emit(\"update:address\", addressObj.text);\n            });\n          }\n          emit(\"update:address\", addressObj.text);\n        }\n      }\n    }\n    return {\n      axiosAddress,\n      ...toRefs(addressObj),\n      reLocation\n    };\n  },\n  props: {\n    propMid: {\n      type: String,\n      default: \"\"\n    }\n  },\n  data() {\n    return {};\n  },\n  computed: {\n    ...mapState([\"uId\"])\n  }\n};\n</script>\n<style lang=\"stylus\" scoped>\n#container\n  display none\n.address\n  border-bottom 10px solid #e5e5e5\n  &.fail\n    /deep/.van-field__control\n      color #999\n/deep/.van-cell\n  font-size 16px\n/deep/.van-field__label\n  color #333\n/deep/.van-cell\n  padding 10px 12px\n</style>\n","import { render } from \"./local.vue?vue&type=template&id=05f2b61d&scoped=true\"\nimport script from \"./local.vue?vue&type=script&lang=js\"\nexport * from \"./local.vue?vue&type=script&lang=js\"\n\nimport \"./local.vue?vue&type=style&index=0&id=05f2b61d&lang=stylus&scoped=true\"\n\nimport exportComponent from \"/Users/wuhelong/Documents/project_two/全市一体化/quan_h5/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-05f2b61d\"]])\n\nexport default __exports__","import { render } from \"./ask.vue?vue&type=template&id=c08b0a06&scoped=true\"\nimport script from \"./ask.vue?vue&type=script&lang=js\"\nexport * from \"./ask.vue?vue&type=script&lang=js\"\n\nimport \"./ask.vue?vue&type=style&index=0&id=c08b0a06&lang=stylus&scoped=true\"\n\nimport exportComponent from \"/Users/wuhelong/Documents/project_two/全市一体化/quan_h5/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-c08b0a06\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./local.vue?vue&type=style&index=0&id=05f2b61d&lang=stylus&scoped=true\"","import BMapGL from \"BMapGL\";\n// import storage from \"good-storage\";\nimport { useStore } from \"vuex\";\nimport { computed } from \"vue\";\n\nexport function geolocation() {\n  // 浏览器精确定位\n  // console.log(\"store\", store);\n  return new Promise(resolve => {\n    // console.log(\"已经定位\", axiosAddressComputed.value);\n    const store = useStore();\n    const axiosAddressComputed = computed(() => store.state.axiosAddress);\n\n    if (\n      axiosAddressComputed.value !== \"\" &&\n      axiosAddressComputed.value !== undefined\n    ) {\n      // 如果已经定位过了，直接返回定位的地址\n      // console.log(\"已经定位\", axiosAddressComputed.value);\n      resolve(axiosAddressComputed.value);\n      return;\n    }\n    var geolocation = new BMapGL.Geolocation();\n    geolocation.getCurrentPosition(function(r) {\n      console.log(\"this.getStatus()\", this.getStatus());\n      if (this.getStatus() == 0) {\n        let axiosAddress =\n          r.address.province +\n          \",\" +\n          r.address.city +\n          (r.address.district ? \",\" + r.address.district : \"\");\n        // good-storage 保存地址\n        // 1.保存 接口使用的地址\n        // console.log(\"address\", address);\n        // 保存接口请求的地址\n        // console.log(\"返回地址\", axiosAddress);\n        store.commit(\"setAxiosAddress\", axiosAddress);\n        store.commit(\"setGeoAddress\", axiosAddress);\n        //保存定位的地址\n        resolve(axiosAddress);\n      } else {\n        // 定位失败，去到下一步，判断个人资料\n        store.commit(\"setGeoAddress\", \"定位失败\");\n        if (this.getStatus() === 6) {\n          // this.getStatus == 6 表示权限未打开\n          resolve(6);\n        } else {\n          resolve(99);\n        }\n      }\n    });\n  });\n}\n\nexport function getCityAddress() {\n  // ip定位，获取市\n  return new Promise(resolve => {\n    function myFun(result) {\n      var cityName = result.name;\n      resolve(cityName);\n    }\n    var myCity = new BMapGL.LocalCity();\n    myCity.get(myFun);\n  });\n}\n\nexport function geo() {\n  const store = useStore();\n  function geolocationAgain() {\n    // 浏览器精确定位\n    // console.log(\"store\", store);\n    return new Promise(resolve => {\n      // console.log(\"已经定位\", axiosAddressComputed.value);\n      var geolocation = new BMapGL.Geolocation();\n      geolocation.getCurrentPosition(function(r) {\n        console.log(\"this.getStatus()\", this.getStatus());\n        if (this.getStatus() == 0) {\n          let axiosAddress =\n            r.address.province +\n            \",\" +\n            r.address.city +\n            (r.address.district ? \",\" + r.address.district : \"\");\n          // good-storage 保存地址\n          // 1.保存 接口使用的地址\n          // console.log(\"address\", address);\n          // 保存接口请求的地址\n          // console.log(\"返回地址\", axiosAddress);\n          // store.commit(\"setAxiosAddress\", axiosAddress);\n          store.commit(\"setGeoAddress\", axiosAddress);\n          //保存定位的地址\n          resolve(axiosAddress);\n        } else {\n          // 定位失败，去到下一步，判断个人资料\n          store.commit(\"setGeoAddress\", \"定位失败\");\n          if (this.getStatus() === 6) {\n            // this.getStatus == 6 表示权限未打开\n            resolve(6);\n          } else {\n            resolve(99);\n          }\n        }\n      });\n    });\n  }\n  return {\n    geolocationAgain\n  };\n}\n\nexport function askGeo() {\n  //\n  function askGeolocationAgain() {\n    // 浏览器精确定位\n    return new Promise(resolve => {\n      // console.log(\"已经定位\", axiosAddressComputed.value);\n      var geolocation = new BMapGL.Geolocation();\n      geolocation.getCurrentPosition(function(r) {\n        // console.log(\"this.getStatus()\", this.getStatus());\n        if (this.getStatus() == 0) {\n          let axiosAddress =\n            r.address.province +\n            \",\" +\n            r.address.city +\n            (r.address.district ? \",\" + r.address.district : \"\");\n          // good-storage 保存地址\n          // 1.保存 接口使用的地址\n          // console.log(\"address\", address);\n          // 保存接口请求的地址\n          // console.log(\"返回地址\", axiosAddress);\n          // store.commit(\"setAxiosAddress\", axiosAddress);\n          // store.commit(\"setGeoAddress\", axiosAddress);\n          //保存定位的地址\n          resolve(axiosAddress);\n        } else {\n          // 定位失败，去到下一步，判断个人资料\n          // store.commit(\"setGeoAddress\", \"定位失败\");\n          if (this.getStatus() === 6) {\n            // this.getStatus == 6 表示权限未打开\n            resolve(6);\n          } else {\n            resolve(99);\n          }\n        }\n      });\n    });\n  }\n  return {\n    askGeolocationAgain\n  };\n}\n"],"sourceRoot":""}