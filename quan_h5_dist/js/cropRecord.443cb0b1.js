(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["cropRecord"],{"0cb2":function(e,t,i){var n=i("7b0b"),o=Math.floor,a="".replace,c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,s=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,i,r,u,d){var l=i+e.length,f=r.length,h=s;return void 0!==u&&(u=n(u),h=c),a.call(d,h,(function(n,a){var c;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,i);case"'":return t.slice(l);case"<":c=u[a.slice(1,-1)];break;default:var s=+a;if(0===s)return n;if(s>f){var d=o(s/10);return 0===d?n:d<=f?void 0===r[d-1]?a.charAt(1):r[d-1]+a.charAt(1):n}c=r[s-1]}return void 0===c?"":c}))}},"14af":function(e,t,i){"use strict";i("3eb4")},"21ae":function(e,t,i){"use strict";i("35fe")},"35fe":function(e,t,i){},"3eb4":function(e,t,i){},"4e95":function(e,t,i){"use strict";i.r(t);i("b0c0");var n=i("7a23");Object(n["K"])("data-v-7448a238");var o={class:"base_edit-container"},a=Object(n["k"])("span",{class:"back"},"返回",-1),c={class:"edit-container"},s={class:"use-medicine"},r=Object(n["k"])("div",{class:"title"},"用药",-1),u={class:"medicine-li"},d={class:"submit-wrap"},l=Object(n["m"])("发布");function f(e,t,i,f,h,m){var b=Object(n["P"])("van-icon"),p=Object(n["P"])("Header"),g=Object(n["P"])("van-field"),v=Object(n["P"])("van-picker"),j=Object(n["P"])("van-popup"),O=Object(n["P"])("van-calendar"),k=Object(n["P"])("van-uploader"),I=Object(n["P"])("van-button"),_=Object(n["P"])("van-form");return Object(n["H"])(),Object(n["j"])("div",o,[Object(n["n"])(p,{indexHeader:!1},{default:Object(n["Z"])((function(){return[Object(n["k"])("div",{class:"icon",onClick:t[0]||(t[0]=function(){return m.goBack&&m.goBack.apply(m,arguments)})},[Object(n["n"])(b,{name:"arrow-left",class:"back-icon"}),a])]})),_:1}),Object(n["k"])("div",c,[Object(n["n"])(_,{onSubmit:m.onSubmit},{default:Object(n["Z"])((function(){return[Object(n["n"])(g,{class:"case",readonly:"",clickable:"",autosize:"",name:"case",type:"textarea",rows:"1",modelValue:h.caseValue,"onUpdate:modelValue":t[1]||(t[1]=function(e){return h.caseValue=e}),label:"方案",placeholder:"请选择",onClick:m.clickCase,rules:[{required:!0,message:"方案不能为空"}]},null,8,["modelValue","onClick"]),Object(n["n"])(j,{show:h.showPicker,"onUpdate:show":t[3]||(t[3]=function(e){return h.showPicker=e}),position:"bottom"},{default:Object(n["Z"])((function(){return[Object(n["n"])(v,{ref:"casePick","show-toolbar":"",columns:h.caseColumns,onConfirm:m.onCaseConfirm,onCancel:t[2]||(t[2]=function(e){return h.showPicker=!1}),key:h.caseValue},null,8,["columns","onConfirm"])]})),_:1},8,["show"]),Object(n["k"])("div",null,[Object(n["n"])(g,{readonly:"",clickable:"",name:"datetime",modelValue:h.date,"onUpdate:modelValue":t[4]||(t[4]=function(e){return h.date=e}),label:"时间",placeholder:"添加时间",onClick:t[5]||(t[5]=function(e){return h.show=!0}),rules:[{required:!0,message:"时间不能为空"}]},null,8,["modelValue"]),Object(n["n"])(O,{title:"请选择开始和结束日期",show:h.show,"onUpdate:show":t[6]||(t[6]=function(e){return h.show=e}),type:"range","allow-same-day":!0,onConfirm:m.onTimeConfirm,color:"#155BBB","min-date":h.minDate,"max-date":h.maxDate},null,8,["show","onConfirm","min-date","max-date"]),Object(n["n"])(g,{modelValue:h.message,"onUpdate:modelValue":t[7]||(t[7]=function(e){return h.message=e}),rows:"2",autosize:"",label:"记录",type:"textarea",maxlength:"500",placeholder:"文字添加记录内容","show-word-limit":"",rules:[{required:!0,message:"记录不能为空"}]},null,8,["modelValue"]),Object(n["n"])(g,{name:"uploader",label:"照片"},{input:Object(n["Z"])((function(){return[Object(n["n"])(k,{modelValue:h.uploader,"onUpdate:modelValue":t[8]||(t[8]=function(e){return h.uploader=e}),"after-read":m.afterRead,"before-delete":m.deleteItem,accept:"image/*","max-count":6,"before-read":m.beforeRead},null,8,["modelValue","after-read","before-delete","before-read"])]})),_:1})]),Object(n["k"])("div",s,[r,(Object(n["H"])(!0),Object(n["j"])(n["b"],null,Object(n["N"])(h.medicine,(function(e,i){return Object(n["H"])(),Object(n["j"])("div",{class:"add-box van-hairline--bottom",key:e.specid},[Object(n["n"])(b,{name:"cross",class:"cross",onClick:function(e){return m.closeMedicine(i)}},null,8,["onClick"]),Object(n["k"])("div",u,[Object(n["n"])(g,{readonly:"",clickable:"",name:"picker",modelValue:e.name,"onUpdate:modelValue":function(t){return e.name=t},label:"名称",placeholder:"请选择药品",onClick:function(e){return m.clickChooseDrug(i)},rules:[{required:!0,message:"药品名称不能为空"}]},null,8,["modelValue","onUpdate:modelValue","onClick"]),Object(n["n"])(j,{show:h.drugPicker,"onUpdate:show":t[10]||(t[10]=function(e){return h.drugPicker=e}),position:"bottom"},{default:Object(n["Z"])((function(){return[Object(n["n"])(v,{"show-toolbar":"",columns:h.medicineColumns,onConfirm:m.onDrugConfirm,onCancel:t[9]||(t[9]=function(e){return h.drugPicker=!1})},null,8,["columns","onConfirm"])]})),_:1},8,["show"])]),Object(n["k"])("div",null,[Object(n["n"])(g,{readonly:"",clickable:"",name:"picker",modelValue:e.spec,"onUpdate:modelValue":function(t){return e.spec=t},label:"规格",placeholder:"请选择规格",onClick:function(e){return m.clickChooseDrugSize(i)},rules:[{required:!0,message:"规格不能为空"}]},null,8,["modelValue","onUpdate:modelValue","onClick"]),Object(n["n"])(j,{show:h.guigeShow,"onUpdate:show":t[12]||(t[12]=function(e){return h.guigeShow=e}),position:"bottom"},{default:Object(n["Z"])((function(){return[Object(n["n"])(v,{"show-toolbar":"",columns:m.afterDrugSizeColumns,onConfirm:m.onDrugSizeConfirm,onCancel:t[11]||(t[11]=function(e){return h.guigeShow=!1})},null,8,["columns","onConfirm"])]})),_:1},8,["show"])]),Object(n["n"])(g,{modelValue:e.quantity,"onUpdate:modelValue":function(t){return e.quantity=t},name:"用量/用法",label:"用量/用法",placeholder:"请输入用量/用法",class:"number",rules:[{required:!0,message:"用量/用法不能为空"}]},null,8,["modelValue","onUpdate:modelValue"])])})),128)),Object(n["k"])("div",{class:"add-btn-title",onClick:t[13]||(t[13]=function(){return m.addMedicine&&m.addMedicine.apply(m,arguments)})},"增加")]),Object(n["k"])("div",d,[Object(n["n"])(I,{round:"",block:"",type:"info","native-type":"submit",class:"submit",color:"#155BBB"},{default:Object(n["Z"])((function(){return[l]})),_:1})])]})),_:1},8,["onSubmit"])])])}Object(n["I"])();var h=i("3835"),m=i("5530"),b=(i("159b"),i("d3b7"),i("a434"),i("99af"),i("a15b"),i("4de4"),i("f392")),p=i("5502"),g=i("7c8d"),v=i.n(g),j={metaInfo:{title:"发布农事"},name:"base_edit",components:{Header:b["a"]},props:{},data:function(){return{eitdObj:"",caseValue:"",caseId:"",caseColumns:[],showPicker:!1,date:"",minDate:new Date(2010,1,1),maxDate:new Date(2030,1,1),show:!1,message:"",uploader:[],imgList:[],medicine:[],drugValue:"",medicineColumns:[],drugSizeValue:"",drugNumber:0,haveMedicine:!1,drugPicker:!1,guigeShow:!1,chooseDrugActiveIndex:0,chooseDrugSizeActive:0}},computed:Object(m["a"])(Object(m["a"])({},Object(p["e"])(["mid","uId"])),{},{classId:function(){return this.$route.query.classId},id:function(){return this.$route.query.id},afterDrugSizeColumns:function(){var e=this,t=[];return this.medicineColumns.forEach((function(i){e.medicine[e.chooseDrugSizeActive].productid==i.productid&&(t=i.spec_list)})),t},druginfo_product_ids:function(){var e=[];return this.medicine.forEach((function(t){e.push(t.productid)})),e},druginfo_spec_ids:function(){var e=[];return this.medicine.forEach((function(t){e.push(t.specid)})),e},druginfo_product_quantity:function(){var e=[];return this.medicine.forEach((function(t){e.push(t.quantity)})),e},editCase:function(){return this.$route.query.editCase}}),watch:{},mounted:function(){this.getCase(),this.getDrugChooseCase(),this.id&&this.getEditData(),this.classId&&this.getOneCaseData()},unmounted:function(){},methods:{clickCase:function(){"no"!==this.editCase&&(this.showPicker=!0)},beforeRead:function(e){return new Promise((function(t){new v.a(e,{quality:.6,success:function(e){t(e)},error:function(e){this.$toast(e.message)}})}))},afterRead:function(e,t){var i=this,n=new FormData;n.append("urls[]",e.file,e.file.name),this.$axios.fetchPost("/Mobile/Wen/OssUploadFile",n).then((function(e){if(0==e.data.code)i.imgList.push(e.data.data);else{i.$toast(e.data.message);var n=t.index;i.uploader.splice(n,1)}}))},deleteItem:function(e,t){var i=t.index;return this.imgList.splice(i,1),!0},getEditData:function(){var e=this;this.$axios.fetchGet("/Mobile/Gbase/getfarmerdata",{Id:this.id}).then((function(t){if(0==t.data.code){var i=t.data.data;e.caseValue=i.point_name,e.date="".concat(i.starttime,"/").concat(i.endtime),e.message=i.content,e.medicine=i.druginfo,i.thumb_urls.forEach((function(t){e.uploader.push({url:t}),e.imgList.push(t)}))}}))},getOneCaseData:function(){var e=this;this.$axios.fetchGet("/Mobile/gbase/getProjectPointData",{classId:this.classId,uId:this.uId}).then((function(t){if(0==t.data.code){var i=t.data.data;e.caseValue=i.point_name,e.caseId=i.point_name_ids,e.date="".concat(i.starttime,"/").concat(i.endtime),e.message=i.content,e.medicine=i.druginfo,i.thumb_urls&&i.thumb_urls.forEach((function(t){e.uploader.push({url:t}),e.imgList.push(t)}))}}))},onCaseConfirm:function(){var e=this.$refs.casePick.getValues();""==e[2].pid?this.caseId=e[0].id+"_"+e[1].id:this.caseId=e[0].id+"_"+e[2].id,console.log("r",e),console.log("this.caseId",this.caseId),this.caseValue=e[0].text+"-"+e[1].text+"-"+e[2].text,this.showPicker=!1},formatDate:function(e){return"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate())},onTimeConfirm:function(e){var t=Object(h["a"])(e,2),i=t[0],n=t[1];this.show=!1,this.date="".concat(this.formatDate(i),"/").concat(this.formatDate(n))},onSubmit:function(e){console.log("submit",e),this.issueFramData()},issueFramData:function(){var e=this,t={},i="",n="";this.id?(t={planer:this.caseId,Id:this.id,starttoendtime:this.date,content:this.message,picurl:this.imgList.join(","),druginfo_product_ids:this.druginfo_product_ids,druginfo_spec_ids:this.druginfo_spec_ids,druginfo_product_quantity:this.druginfo_product_quantity},i="修改成功",n="/Mobile/Gbase/subfarmerdata"):(t={planer:this.caseId,uId:this.uId,starttoendtime:this.date,content:this.message,picurl:this.imgList.join(","),druginfo_product_ids:this.druginfo_product_ids,druginfo_spec_ids:this.druginfo_spec_ids,druginfo_product_quantity:this.druginfo_product_quantity,rtype:this.classId?"plan":""},i="发布成功",n="/Mobile/Gbase/addfarmerdata"),this.$axios.fetchPost(n,t).then((function(t){0==t.data.code?(e.$toast.success(i),setTimeout((function(){e.$router.go(-1)}),500)):e.$toast.fail(t.data.message)}))},getCase:function(){var e=this;this.$axios.fetchGet("/Mobile/Gbase/getProjectlist",{mId:this.mid,uId:this.uId}).then((function(t){0==t.data.code&&(e.caseColumns=t.data.data)}))},getDrugChooseCase:function(){var e=this;this.$axios.fetchGet("/Mobile/Gbase/getBaseDruginfo",{uId:this.uId}).then((function(t){var i=t.data;0===i.code&&(e.medicineColumns=i.data)}))},clickChooseDrug:function(e){this.chooseDrugActiveIndex=e,this.drugPicker=!0,this.chooseDrugSizeActive=e},onDrugConfirm:function(e){this.drugPicker=!1,this.medicine[this.chooseDrugActiveIndex].name=e.name,this.medicine[this.chooseDrugActiveIndex].productid=e.productid;var t=this.medicine[this.chooseDrugActiveIndex].spec,i=e.spec_list.filter((function(e){return e.spec==t}));0==i.length&&(this.medicine[this.chooseDrugActiveIndex].spec=e.spec_list[0].spec,this.medicine[this.chooseDrugActiveIndex].specid=e.spec_list[0].id)},clickChooseDrugSize:function(e){this.chooseDrugSizeActive=e,this.chooseDrugActiveIndex=e,this.guigeShow=!0},onDrugSizeConfirm:function(e){this.medicine[this.chooseDrugActiveIndex].spec=e.spec,this.medicine[this.chooseDrugActiveIndex].specid=e.id,this.guigeShow=!1},closeMedicine:function(e){var t=this;this.$dialog.confirm({title:"删除用药",message:"是否要删除用药"}).then((function(){t.medicine.splice(e,1)}))},addMedicine:function(){this.medicine.push({name:"",spec:"",specid:"",quantity:"",drugId:"",productid:""})},goBack:function(){this.$router.go(-1)}}},O=(i("21ae"),i("d959")),k=i.n(O);const I=k()(j,[["render",f],["__scopeId","data-v-7448a238"]]);t["default"]=I},5319:function(e,t,i){"use strict";var n=i("d784"),o=i("d039"),a=i("825a"),c=i("a691"),s=i("50c4"),r=i("577e"),u=i("1d80"),d=i("8aa5"),l=i("0cb2"),f=i("14c3"),h=i("b622"),m=h("replace"),b=Math.max,p=Math.min,g=function(e){return void 0===e?e:String(e)},v=function(){return"$0"==="a".replace(/./,"$0")}(),j=function(){return!!/./[m]&&""===/./[m]("a","$0")}(),O=!o((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));n("replace",(function(e,t,i){var n=j?"$":"$0";return[function(e,i){var n=u(this),o=void 0==e?void 0:e[m];return void 0!==o?o.call(e,n,i):t.call(r(n),e,i)},function(e,o){var u=a(this),h=r(e);if("string"===typeof o&&-1===o.indexOf(n)&&-1===o.indexOf("$<")){var m=i(t,u,h,o);if(m.done)return m.value}var v="function"===typeof o;v||(o=r(o));var j=u.global;if(j){var O=u.unicode;u.lastIndex=0}var k=[];while(1){var I=f(u,h);if(null===I)break;if(k.push(I),!j)break;var _=r(I[0]);""===_&&(u.lastIndex=d(h,s(u.lastIndex),O))}for(var w="",C=0,y=0;y<k.length;y++){I=k[y];for(var D=r(I[0]),$=b(p(c(I.index),h.length),0),x=[],P=1;P<I.length;P++)x.push(g(I[P]));var V=I.groups;if(v){var q=[D].concat(x,$,h);void 0!==V&&q.push(V);var H=r(o.apply(void 0,q))}else H=l(D,h,$,x,V,o);$>=C&&(w+=h.slice(C,$)+H,C=$+D.length)}return w+h.slice(C)}]}),!O||!v||j)},"634b":function(e,t,i){},9842:function(e,t,i){"use strict";i.r(t);var n=i("7a23");Object(n["K"])("data-v-222f9594");var o={class:"crop_record-container"},a={class:"nav-bar van-hairline--bottom"},c=Object(n["m"])(" 农事管理 "),s=Object(n["m"])("农事记录"),r={class:"farm-record-content"},u={class:"bottom-bar"},d=Object(n["k"])("span",null,"发布农事",-1),l={class:"no-take-wrap"},f=Object(n["k"])("p",null,"暂无记录",-1),h=[f];function m(e,t,i,f,m,b){var p=Object(n["P"])("router-link"),g=Object(n["P"])("FramItem"),v=Object(n["P"])("van-list"),j=Object(n["P"])("van-icon");return Object(n["H"])(),Object(n["j"])("div",o,[Object(n["k"])("div",a,[Object(n["n"])(p,{class:"nav",to:{path:"/cropManagement",query:{pId:this.$route.query.pId,gId:this.$route.query.gId}},replace:""},{default:Object(n["Z"])((function(){return[c]})),_:1},8,["to"]),Object(n["n"])(p,{class:"nav",to:{path:"/cropRecord",query:{pId:this.$route.query.pId,gId:this.$route.query.gId}},replace:""},{default:Object(n["Z"])((function(){return[s]})),_:1},8,["to"])]),Object(n["k"])("div",r,[Object(n["ab"])(Object(n["n"])(v,{loading:m.loading,"onUpdate:loading":t[0]||(t[0]=function(e){return m.loading=e}),finished:m.finished,"finished-text":"没有更多了",onLoad:b.onLoad},{default:Object(n["Z"])((function(){return[(Object(n["H"])(!0),Object(n["j"])(n["b"],null,Object(n["N"])(m.list,(function(e){return Object(n["H"])(),Object(n["h"])(g,{key:e.id,item:e,onPriview:b.imagePriview,onDeteleHistory:b.updateDeteleHistory},null,8,["item","onPriview","onDeteleHistory"])})),128))]})),_:1},8,["loading","finished","onLoad"]),[[n["X"],!m.noData]]),Object(n["k"])("div",u,[Object(n["k"])("div",{class:"issue-btn1",onClick:t[1]||(t[1]=function(){return b.goToIssueFram&&b.goToIssueFram.apply(b,arguments)})},[Object(n["n"])(j,{name:"plus",class:"issue-icon"}),d])])]),Object(n["ab"])(Object(n["k"])("div",l,h,512),[[n["X"],m.noData]])])}Object(n["I"])();var b=i("5530");i("ac1f"),i("5319"),i("99af"),i("4de4");Object(n["K"])("data-v-4bab0f24");var p={class:"item van-hairline--bottom"},g={class:"text"},v={class:"edit-bar"},j=Object(n["k"])("div",{class:"edit-icon"},null,-1),O=Object(n["m"])(" 更改 "),k=[j,O];function I(e,t,i,o,a,c){var s=Object(n["P"])("van-image"),r=Object(n["P"])("van-icon");return Object(n["H"])(),Object(n["j"])("div",p,[Object(n["k"])("div",{class:"left-time",onClick:t[0]||(t[0]=function(e){return c.detail(i.item.id)})},Object(n["T"])(i.item.adddate),1),Object(n["k"])("div",g,[Object(n["k"])("div",{class:"p",onClick:t[1]||(t[1]=function(e){return c.detail(i.item.id)})},Object(n["T"])(i.item.content),1),(Object(n["H"])(!0),Object(n["j"])(n["b"],null,Object(n["N"])(i.item.thumb_urls,(function(e,t){return Object(n["H"])(),Object(n["h"])(s,{class:"img",key:t,fit:"cover",src:e,onClick:function(e){return c.showPriviewImg(i.item.thumb_urls,t)}},null,8,["src","onClick"])})),128)),Object(n["k"])("div",v,[Object(n["k"])("div",{class:"left",onClick:t[2]||(t[2]=function(e){return c.edit(i.item.id)})},k),Object(n["i"])("",!0),Object(n["k"])("div",{class:"medicine-icon",onClick:t[4]||(t[4]=function(e){return c.detail(i.item.id)})},[Object(n["n"])(r,{name:"arrow",class:"arrow"})])])])])}Object(n["I"])();var _={name:"fram_item",components:{},props:{item:{type:Object,default:function(){return{}}}},data:function(){return{}},computed:{},watch:{},mounted:function(){},unmounted:function(){},methods:{showPriviewImg:function(e,t){var i={imgList:e,index:t};this.$emit("priview",i)},deteleFramHistory:function(e){var t=this;this.$dialog.confirm({message:"确定删除"}).then((function(){t.detetleHistory(e)})).catch((function(){}))},detetleHistory:function(e){var t=this;this.$axios.fetchGet("/Mobile/User/delfarmerdata",{Id:e}).then((function(i){0==i.data.code&&t.$emit("deteleHistory",e)}))},edit:function(e){this.$router.push({path:"/base_edit",query:{id:e}})},detail:function(e){this.$router.push({path:"/base_edit",query:{id:e}})}}},w=(i("d4fe"),i("d959")),C=i.n(w);const y=C()(_,[["render",I],["__scopeId","data-v-4bab0f24"]]);var D=y,$=i("482f"),x=i("5502"),P={name:"crop_record",components:{FramItem:D},props:{},data:function(){return{list:[],noData:!1,page:0,loading:!1,finished:!1}},computed:Object(b["a"])(Object(b["a"])({},Object(x["e"])(["uId"])),{},{gId:function(){return this.$route.query.gId},pId:function(){return this.$route.query.pId}}),watch:{},mounted:function(){this.getHistoryList()},unmounted:function(){},methods:{onLoad:function(){this.getHistoryList()},goLook:function(){this.$router.replace({path:"/into_hospital"})},getHistoryList:function(){var e=this;this.id=this.$route.query.id,this.page++,this.loading=!0,this.$axios.fetchGet("/Mobile/Gbase/getgbaserecordlist",{uId:this.uId,page:this.page,pId:this.pId}).then((function(t){0==t.data.code&&(e.list=e.list.concat(t.data.data),e.loading=!1),201==t.data.code&&(1==e.page?e.noData=!0:e.finished=!0)}))},imagePriview:function(e){Object($["a"])({images:e.imgList,startPosition:e.index,closeable:!0})},updateDeteleHistory:function(e){this.list=this.list.filter((function(t){return t.id!=e}))},goBack:function(){this.$router.go(-1)},goToIssueFram:function(){this.$router.push({path:"/base_edit"})}}};i("14af");const V=C()(P,[["render",m],["__scopeId","data-v-222f9594"]]);t["default"]=V},d4fe:function(e,t,i){"use strict";i("634b")}}]);
//# sourceMappingURL=cropRecord.443cb0b1.js.map