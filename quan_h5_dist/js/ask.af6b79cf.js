(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ask"],{"010e":function(t,e,n){"use strict";n("2f44")},1531:function(t,e,n){},"2ec8":function(t,e,n){"use strict";n.r(e);var a=n("7a23");Object(a["K"])("data-v-c08b0a06");var o={class:"ask-container"},s=Object(a["k"])("div",{class:"title"},"问题描述",-1),i=Object(a["k"])("div",{class:"left"},"作物",-1),r={key:0,class:"list"},c=Object(a["k"])("div",{class:"left"},"咨询专家",-1),u={class:"right"},d={class:"sub"},l=Object(a["m"])(" 提交 ");function f(t,e,n,f,b,m){var p=Object(a["P"])("Header"),h=Object(a["P"])("HospitalHeader"),j=Object(a["P"])("van-field"),O=Object(a["P"])("van-uploader"),v=Object(a["P"])("van-icon"),g=Object(a["P"])("Loacl"),x=Object(a["P"])("van-button"),k=Object(a["P"])("van-form"),y=Object(a["P"])("router-view"),w=Object(a["P"])("Foot");return Object(a["H"])(),Object(a["j"])("div",o,[Object(a["n"])(p,{indexHeader:!1}),"hospital"==m.from?(Object(a["H"])(),Object(a["h"])(h,{key:0,navHeader:"提问"})):Object(a["i"])("",!0),s,Object(a["n"])(k,{onSubmit:m.onSubmit,class:"from"},{default:Object(a["Z"])((function(){return[Object(a["n"])(j,{modelValue:b.message,"onUpdate:modelValue":e[0]||(e[0]=function(t){return b.message=t}),rows:"4",autosize:"",type:"textarea",placeholder:"请输入具体问题描述",class:"text","show-word-limit":"",maxlength:"300",name:"message"},null,8,["modelValue"]),Object(a["n"])(j,{name:"uploader",class:"uploader"},{input:Object(a["Z"])((function(){return[Object(a["n"])(O,{modelValue:b.uploader,"onUpdate:modelValue":e[1]||(e[1]=function(t){return b.uploader=t}),"after-read":m.afterRead,"before-delete":m.deleteItem,accept:"image/*","max-count":9},null,8,["modelValue","after-read","before-delete"])]})),_:1}),Object(a["k"])("div",{class:"choose-crop",onClick:e[3]||(e[3]=function(){return m.goToChooseCrop&&m.goToChooseCrop.apply(m,arguments)})},[i,Object(a["n"])(j,{modelValue:b.crop,"onUpdate:modelValue":e[2]||(e[2]=function(t){return b.crop=t}),readonly:"",class:Object(a["y"])(["right",{location:"请选择"!=b.crop}]),"input-align":"right",border:!1,name:"crop"},null,8,["modelValue","class"]),Object(a["n"])(v,{name:"arrow",class:"arrow"})]),m.expert?(Object(a["H"])(),Object(a["j"])("div",r,[c,Object(a["k"])("div",u,Object(a["T"])(m.expert),1)])):Object(a["i"])("",!0),Object(a["n"])(g,{propMid:m.from?t.mid:t.initMid,ref:"localRef",address:b.address,"onUpdate:address":e[4]||(e[4]=function(t){return b.address=t})},null,8,["propMid","address"]),Object(a["k"])("div",d,[Object(a["n"])(x,{round:"",block:"",type:"info","native-type":"submit",class:"btn"},{default:Object(a["Z"])((function(){return[l]})),_:1})])]})),_:1},8,["onSubmit"]),Object(a["n"])(y,null,{default:Object(a["Z"])((function(t){var e=t.Component;return[(Object(a["H"])(),Object(a["h"])(a["c"],null,[(Object(a["H"])(),Object(a["h"])(Object(a["R"])(e),{onGetCrop:m.getCrop},null,8,["onGetCrop"]))],1024))]})),_:1}),Object(a["n"])(w)])}Object(a["I"])();var b=n("5530"),m=(n("b0c0"),n("a434"),n("a15b"),n("f392")),p=n("3a6a"),h=n("6751");Object(a["K"])("data-v-05f2b61d");var j=Object(a["k"])("div",{id:"container"},null,-1);function O(t,e,n,o,s,i){var r=Object(a["P"])("van-icon"),c=Object(a["P"])("van-field");return Object(a["H"])(),Object(a["j"])("div",null,[Object(a["n"])(c,{modelValue:t.text,"onUpdate:modelValue":e[0]||(e[0]=function(e){return t.text=e}),class:Object(a["y"])(["address",{fail:"定位中···"===t.text||"抱歉未定位到"===t.text}]),name:"所在位置",label:"所在位置",placeholder:"",readonly:"","input-align":"right",onClick:o.reLocation},{"right-icon":Object(a["Z"])((function(){return[Object(a["n"])(r,{name:"arrow"})]})),_:1},8,["modelValue","class","onClick"]),j])}Object(a["I"])();var v=n("1da1"),g=(n("96cf"),n("e096")),x=n("5502"),k=n("75e6"),y={name:"local",setup:function(t,e){var n=e.emit,o=Object(x["f"])(),s=Object(a["f"])((function(){return o.state.axiosAddress})),i=Object(a["f"])((function(){return o.state.userInfoLocation})),r=Object(a["M"])("first"),c=Object(a["L"])({text:"定位中···"});function u(){return d.apply(this,arguments)}function d(){return d=Object(v["a"])(regeneratorRuntime.mark((function t(){var e,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=Object(g["a"])(),a=e.askGeolocationAgain,c.text="定位中···",t.next=4,a();case 4:if(o=t.sent,6===o||99===o){t.next=11;break}c.text=o,r.value="sucess",n("update:address",c.text),t.next=17;break;case 11:if("first"!=r.value){t.next=16;break}return c.text="抱歉未定位到",r.value="noFirst",n("update:address",c.text),t.abrupt("return");case 16:6==o?""===i.value?k["a"].alert({title:"定位失败",message:"检测到您未打开定位服务",confirmButtonText:"不显示地址",confirmButtonColor:"#155BBB"}).then((function(){c.text="",n("update:address",c.text)})):k["a"].alert({title:"定位失败",message:"检测到您未打开定位服务,已自动切换至 "+i.value,confirmButtonText:"好的",confirmButtonColor:"#155BBB"}).then((function(){c.text=i.value,n("update:address",c.text)})):(""===i.value?k["a"].alert({title:"定位失败",message:"抱歉未定位到您的所在地址,后期可以在“我的-编辑资料-所在地”完善信息",confirmButtonText:"不显示地址",confirmButtonColor:"#155BBB"}).then((function(){c.text="",n("update:address",c.text)})):k["a"].alert({title:"定位失败",message:"抱歉未定位到您的所在地址,已自动切换至 "+i.value,confirmButtonText:"好的",confirmButtonColor:"#155BBB"}).then((function(){c.text=i.value,n("update:address",c.text)})),n("update:address",c.text));case 17:case"end":return t.stop()}}),t)}))),d.apply(this,arguments)}return Object(a["E"])((function(){u()})),Object(b["a"])(Object(b["a"])({axiosAddress:s},Object(a["U"])(c)),{},{reLocation:u})},props:{propMid:{type:String,default:""}},data:function(){return{}},computed:Object(b["a"])({},Object(x["e"])(["uId"]))},w=(n("3975"),n("d959")),B=n.n(w);const C=B()(y,[["render",O],["__scopeId","data-v-05f2b61d"]]);var P=C,I=n("213a"),S=n("7c8d"),A=n.n(S),H={setup:function(){var t=Object(I["c"])({title:"提问"}),e=t.meta;return{meta:e}},name:"ask",components:{Header:m["a"],Foot:h["a"],HospitalHeader:p["a"],Loacl:P},props:{},data:function(){return{address:"定位中···",message:"",crop:"请选择",fid:"",uploader:[],imgList:[],imgListTiny:[],ismember:"",isShaoxing:"",userInfo:"",locationTime:"first",submitBoolean:!0}},computed:Object(b["a"])(Object(b["a"])({},Object(x["e"])(["uId","mid","initMid","hospitalName"])),{},{from:function(){return this.$route.query.from},expert:function(){return this.$route.query.expert},expertId:function(){return this.$route.query.expertId}},Object(x["e"])(["uId"])),created:function(){},watch:{},mounted:function(){this.meta.title="hospital"===this.from?this.hospitalName:"提问"},methods:{onSubmit:function(t){""!=t.message?t.message.length<=9?this.$toast("问题描述不能少余10个字"):"定位中···"!=this.address?this.subAsk():this.$toast("地址定位中,请稍等"):this.$toast("问题描述不能为空")},goToChooseCrop:function(){this.$router.push({path:"/ask/ask_choose_crop",query:{crop:"请选择"==this.crop?"":this.crop}})},getCrop:function(t){this.crop=t.name,this.fid=t.fid},afterRead:function(t,e){var n=this;new A.a(t.file,{quality:.4,success:function(t){var a=new FormData;a.append("urls[]",t,t.name),n.$axios.fetchPost("/Mobile/Wen/OssUploadFile",a).then((function(t){if(0==t.data.code)n.imgList.push(t.data.data),n.imgListTiny.push(t.data.data_tiny);else{n.$toast(t.data.message);var a=e.index;n.uploader.splice(a,1)}}))}})},deleteItem:function(t,e){var n=e.index;return this.imgList.splice(n,1),this.imgListTiny.splice(n,1),!0},subAsk:function(){var t=this,e={mId:this.from?this.mid:this.initMid,uId:this.uId,content:this.message,fId:this.fid,expertId:this.expertId,picurl:this.imgList.join(","),picurl_tiny:this.imgListTiny.join(","),location:"抱歉未定位到"===this.address?"定位失败":this.address};this.submitBoolean&&(this.submitBoolean=!1,this.$axios.fetchPost("Mobile/Wen/addWenQuestion",e).then((function(e){t.$toast(e.data.message),0==e.data.code?setTimeout((function(){t.$router.go(-1),t.submitBoolean=!0}),1e3):t.submitBoolean=!0})))}}};n("010e");const L=B()(H,[["render",f],["__scopeId","data-v-c08b0a06"]]);e["default"]=L},"2f44":function(t,e,n){},3975:function(t,e,n){"use strict";n("1531")},e096:function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return u}));n("d3b7"),n("b0c0");var a=n("3f15"),o=n.n(a),s=n("5502"),i=n("7a23");function r(){return new Promise((function(t){var e=Object(s["f"])(),n=Object(i["f"])((function(){return e.state.axiosAddress}));if(""===n.value||void 0===n.value){var a=new o.a.Geolocation;a.getCurrentPosition((function(n){if(console.log("this.getStatus()",this.getStatus()),0==this.getStatus()){var a=n.address.province+","+n.address.city+(n.address.district?","+n.address.district:"");e.commit("setAxiosAddress",a),e.commit("setGeoAddress",a),t(a)}else e.commit("setGeoAddress","定位失败"),6===this.getStatus()?t(6):t(99)}))}else t(n.value)}))}function c(){var t=Object(s["f"])();function e(){return new Promise((function(e){var n=new o.a.Geolocation;n.getCurrentPosition((function(n){if(console.log("this.getStatus()",this.getStatus()),0==this.getStatus()){var a=n.address.province+","+n.address.city+(n.address.district?","+n.address.district:"");t.commit("setGeoAddress",a),e(a)}else t.commit("setGeoAddress","定位失败"),6===this.getStatus()?e(6):e(99)}))}))}return{geolocationAgain:e}}function u(){function t(){return new Promise((function(t){var e=new o.a.Geolocation;e.getCurrentPosition((function(e){if(0==this.getStatus()){var n=e.address.province+","+e.address.city+(e.address.district?","+e.address.district:"");t(n)}else 6===this.getStatus()?t(6):t(99)}))}))}return{askGeolocationAgain:t}}}}]);
//# sourceMappingURL=ask.af6b79cf.js.map